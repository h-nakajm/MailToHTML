<html>

<head>
	<title>Sign up</title>
	<script src="./js/jquery-3.2.1.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		var dbpath = "http://127.0.0.1:8080/test/participants/";

		// Enterキーでの送信を許さない
		$(function() {
			$(document).on("keypress", "input:not(.allow_submit)", function(event) {
				return event.which !== 13;
			});
		});

		// enterボタンが押された際の処理
		function Clicked() {

			// テキストフィールドが空欄の場合
			if ($("#id1").val() == "" || $("#id2").val() == "") {
				window.alert("Input your Id.");
				return;
			}
			// テキストフィールドの内容が一致しない場合
			else if ($("#id1").val() != $("#id2").val()) {
				window.alert("The initial ID and the re-typed ID do not match. ");
				return;
			}
			// IDが正しく打ち込まれた場合
			else {
				var date = new Date();
				var seconds = date.getSeconds();
				var ID = $("#id1").val();
				if (seconds % 2 == 0) {
					var next_page = "http://localhost:8000/000139.html?id=" + ID + "&type=static";
					var type = "static";
				} else {
					var next_page = "http://localhost:8000/000139.html?id=" + ID + "&type=anchor";
					var type = "anchor";
				}
				var result = {
					"id": ID,
					"date": date,
					"userAgent": window.navigator.userAgent,
					"type": type
				};

				// 参加者の情報をdbに送る
				$.ajax({
					url: dbpath,
					type: "POST",
					contentType: "application/json",
					data: JSON.stringify(result),
					dataType: 'xml'
				}).done(function(data) { // success
					window.location.href = next_page;
				}).fail(function(data) { // error
					window.alert(textStatus + ": Unable to connect to the server.");
				});
			}
		}
	</script>
</head>

<body>
	<center>
		<h1>Sign up page</h1>
	</center>
	<hr>
	<center>
		Input your participant ID into the field.
		</br>
		</br>
		<form>
			<input type="text" name="id" id="id1" placeholder="your ID"></br>
			</br>
			<input type="text" name="id" id="id2" placeholder="re-type your ID">
		</form>
		<input type="submit" value="enter" onclick="Clicked()">
	</center>
</body>

</html>
